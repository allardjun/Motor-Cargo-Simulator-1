(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    110079,       3061]
NotebookOptionsPosition[    104234,       2864]
NotebookOutlinePosition[    104616,       2881]
CellTagsIndexPosition[    104573,       2878]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Quaternions", "Title",
 CellChangeTimes->{{3.694471709968169*^9, 3.694471722201342*^9}}],

Cell["\<\
The best way to keep track of rotations for solid objects seems to be by \
using quaternions. My simulation natively puts out Euler vector, also called \
axis and angle (for me, force::velocity as torque::euler vector). \
\>", "Text",
 CellChangeTimes->{{3.694471732428337*^9, 3.6944718751673183`*^9}, {
   3.694472002371709*^9, 3.69447201477958*^9}, 3.6948926447426662`*^9, {
   3.694900165380122*^9, 3.694900174811631*^9}}],

Cell["\<\
Can use the quaternions package to define quaternions and their \
multiplication
http://reference.wolfram.com/language/Quaternions/tutorial/Quaternions.html\
\>", "Text",
 CellChangeTimes->{{3.6948885457590103`*^9, 3.694888565040723*^9}, 
   3.694892719127884*^9, {3.694894541142036*^9, 3.694894545224688*^9}, {
   3.694985802844795*^9, 3.6949858030147667`*^9}}],

Cell[BoxData[
 RowBox[{"<<", "Quaternions`"}]], "Input",
 CellChangeTimes->{{3.694886240245954*^9, 3.69488624518748*^9}, {
  3.694886304655385*^9, 3.694886304960005*^9}}],

Cell[TextData[{
 "Check Mathematica\[CloseCurlyQuote]s math is what I think it should be. \
According to https://en.wikipedia.org/wiki/Quaternion#Hamilton_product, we \
should have\n",
 Cell[BoxData[
  GraphicsBox[
   TagBox[RasterBox[CompressedData["
1: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
Ehk=
     "], {{0, 124}, {387, 0}}, {0, 255},
     ColorFunction->RGBColor],
    BoxForm`ImageTag["Byte", ColorSpace -> "RGB", Interleaving -> True],
    Selectable->False],
   DefaultBaseStyle->"ImageGraphics",
   ImageSize->Automatic,
   ImageSizeRaw->{387, 124},
   PlotRange->{{0, 387}, {0, 124}}]], "Input"]
}], "Text",
 CellChangeTimes->{{3.694887635671339*^9, 3.694887665587338*^9}, {
  3.6948882770205793`*^9, 3.6948882856258173`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Quaternion", "[", 
   RowBox[{"a1", ",", "b1", ",", "c1", ",", "d1"}], "]"}], "**", 
  RowBox[{"Quaternion", "[", 
   RowBox[{"a2", ",", "b2", ",", "c2", ",", "d2"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.694887238574095*^9, 3.694887258212253*^9}, {
  3.694887294583782*^9, 3.694887315452149*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"a1", " ", "a2"}], "-", 
    RowBox[{"b1", " ", "b2"}], "-", 
    RowBox[{"c1", " ", "c2"}], "-", 
    RowBox[{"d1", " ", "d2"}]}], ",", 
   RowBox[{
    RowBox[{"a2", " ", "b1"}], "+", 
    RowBox[{"a1", " ", "b2"}], "-", 
    RowBox[{"c2", " ", "d1"}], "+", 
    RowBox[{"c1", " ", "d2"}]}], ",", 
   RowBox[{
    RowBox[{"a2", " ", "c1"}], "+", 
    RowBox[{"a1", " ", "c2"}], "+", 
    RowBox[{"b2", " ", "d1"}], "-", 
    RowBox[{"b1", " ", "d2"}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "b2"}], " ", "c1"}], "+", 
    RowBox[{"b1", " ", "c2"}], "+", 
    RowBox[{"a2", " ", "d1"}], "+", 
    RowBox[{"a1", " ", "d2"}]}]}], "]"}]], "Output",
 CellChangeTimes->{3.694887259264072*^9, 3.694887315843793*^9, 
  3.694894709892593*^9, 3.694985286921081*^9}]
}, Open  ]],

Cell["Checks out", "Text",
 CellChangeTimes->{{3.6948876761037397`*^9, 3.69488767773421*^9}}],

Cell["We can also compute the conjugate", "Text",
 CellChangeTimes->{{3.694985232200625*^9, 3.694985241110284*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Conjugate", "[", 
  RowBox[{"Quaternion", "[", 
   RowBox[{"a1", ",", "b1", ",", "c1", ",", "d1"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.694985244980895*^9, 3.694985249334667*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{"a1", ",", 
   RowBox[{"-", "b1"}], ",", 
   RowBox[{"-", "c1"}], ",", 
   RowBox[{"-", "d1"}]}], "]"}]], "Output",
 CellChangeTimes->{3.6949852503787117`*^9, 3.694985286960196*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Translate axis and angle to quaternion", "Section",
 CellChangeTimes->{{3.69489265042039*^9, 3.69489267593484*^9}}],

Cell["\<\
Translation between the two seems simple enough. According to \
http://www.euclideanspace.com/maths/geometry/rotations/conversions/\
angleToQuaternion/index.htm,
this is accomplished by q={Cos[\[Alpha]/2],x/\[Alpha] Sin[\[Alpha]/2],y/\
\[Alpha] Sin[\[Alpha]/2],z/\[Alpha] Sin[\[Alpha]/2]}, for an Euler vector \
{x,y,z} with magnitude \[Alpha]\
\>", "Text",
 CellChangeTimes->{
  3.694892681595228*^9, {3.694894547992194*^9, 3.694894619454176*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"convertToQuaternion", "[", 
   RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[Alpha]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Alpha]", "=", 
      RowBox[{"Norm", "[", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y", ",", "z"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Quaternion", "[", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"\[Alpha]", "/", "2"}], "]"}], ",", 
       RowBox[{
        RowBox[{"x", "/", "\[Alpha]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Alpha]", "/", "2"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"y", "/", "\[Alpha]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Alpha]", "/", "2"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"z", "/", "\[Alpha]"}], " ", 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Alpha]", "/", "2"}], "]"}]}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.694472019482131*^9, 3.6944721869271803`*^9}, 
   3.694472220384625*^9, {3.6948880373524427`*^9, 3.694888042008224*^9}, {
   3.69489449791885*^9, 3.694894505883608*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"q", "=", 
  RowBox[{"convertToQuaternion", "[", 
   RowBox[{"0", ",", 
    RowBox[{"Pi", "/", "2"}], ",", "0"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.69447222430013*^9, 3.694472236696919*^9}, {
  3.694472303298541*^9, 3.694472303353088*^9}, {3.694888011758707*^9, 
  3.6948880149069433`*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   FractionBox["1", 
    SqrtBox["2"]], ",", "0", ",", 
   FractionBox["1", 
    SqrtBox["2"]], ",", "0"}], "]"}]], "Output",
 CellChangeTimes->{
  3.694472237647017*^9, 3.694472304682871*^9, 3.6948863384986877`*^9, {
   3.694888015120936*^9, 3.694888044973229*^9}, 3.694894510244381*^9, 
   3.69489470995077*^9, 3.694985287016214*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Rotate vector", "Section",
 CellChangeTimes->{{3.6948927317128487`*^9, 3.694892740093495*^9}}],

Cell["\<\
Then, according to this
http://math.stackexchange.com/questions/40164/how-do-you-rotate-a-vector-by-a-\
unit-quaternion and \
http://gamedev.stackexchange.com/questions/28395/rotating-vector3-by-a-\
quaternion
we should be able to rotate a vector by this quaternion by \
p\[CloseCurlyQuote]=qpq*, where p is the pure quaternion made from the vector \
v by p=[0,v1,v2,v3], p\[CloseCurlyQuote] is the rotated pure quaternion, and \
q* is the conjugate of q, q*=[q1,-q2,-q3,-q4]\
\>", "Text",
 CellChangeTimes->{{3.694472250434238*^9, 3.694472310417981*^9}, {
  3.694472398339033*^9, 3.694472400148447*^9}, {3.69488832652*^9, 
  3.694888476244998*^9}, {3.694889749662054*^9, 3.69488975096797*^9}}],

Cell["Then we can rotate a vector by a an euler vector by", "Text",
 CellChangeTimes->{{3.694888642981052*^9, 3.6948886720615788`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotateVectorByEV", "[", 
   RowBox[{"v_", ",", "EV_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"quatOut", ",", "q"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"q", "=", 
      RowBox[{"convertToQuaternion", "[", 
       RowBox[{
        RowBox[{"EV", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"EV", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"EV", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"quatOut", "=", 
      RowBox[{"q", "**", 
       RowBox[{"Quaternion", "[", 
        RowBox[{"0", ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "**", 
       RowBox[{"Conjugate", "[", "q", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6948881207586184`*^9, 3.694888187188911*^9}, 
   3.6948946802824793`*^9, {3.69498525942629*^9, 3.694985271271949*^9}}],

Cell["Test it out", "Text",
 CellChangeTimes->{{3.694888695336954*^9, 3.694888703955316*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"rotateVectorByEV", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"Pi", "/", "2"}], ",", "0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.694888228499857*^9, 3.694888255959429*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", 
   RowBox[{"-", "1"}]}], "}"}]], "Output",
 CellChangeTimes->{3.694888256317565*^9, 3.6948947100231447`*^9, 
  3.694985287054428*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"RotationMatrix", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "2"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
  RowBox[{"{", 
   RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.6948887119109507`*^9, 3.694888768451476*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", 
   RowBox[{"-", "1"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.694888739880221*^9, 3.694888768690061*^9}, 
   3.694894710069388*^9, 3.694985287096257*^9}]
}, Open  ]],

Cell["Then the general form", "Text",
 CellChangeTimes->{{3.6948888019655123`*^9, 3.694888806104928*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"genq", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{"rotateVectorByEV", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"EV1", ",", "EV2", ",", "EV3"}], "}"}]}], "]"}], ",", 
    RowBox[{"Assumptions", "\[Rule]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "v1", ",", "v2", ",", "v3", ",", "EV1", ",", "EV2", ",", "EV3"}], 
       "}"}], "\[Element]", "Reals"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6948888162084427`*^9, 3.694888905093479*^9}, {
  3.69488908739997*^9, 3.6948890895591993`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox["1", 
     RowBox[{
      SuperscriptBox["EV1", "2"], "+", 
      SuperscriptBox["EV2", "2"], "+", 
      SuperscriptBox["EV3", "2"]}]], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"EV1", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"EV1", " ", "v1"}], "+", 
         RowBox[{"EV2", " ", "v2"}], "+", 
         RowBox[{"EV3", " ", "v3"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox["EV2", "2"], " ", "v1"}], "-", 
         RowBox[{"EV1", " ", "EV2", " ", "v2"}], "+", 
         RowBox[{"EV3", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"EV3", " ", "v1"}], "-", 
            RowBox[{"EV1", " ", "v3"}]}], ")"}]}]}], ")"}], " ", 
       RowBox[{"Cos", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}], "+", 
      RowBox[{
       SqrtBox[
        RowBox[{
         SuperscriptBox["EV1", "2"], "+", 
         SuperscriptBox["EV2", "2"], "+", 
         SuperscriptBox["EV3", "2"]}]], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "EV3"}], " ", "v2"}], "+", 
         RowBox[{"EV2", " ", "v3"}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}]}], ")"}]}], ",", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      SuperscriptBox["EV1", "2"], "+", 
      SuperscriptBox["EV2", "2"], "+", 
      SuperscriptBox["EV3", "2"]}]], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"EV2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"EV1", " ", "v1"}], "+", 
         RowBox[{"EV2", " ", "v2"}], "+", 
         RowBox[{"EV3", " ", "v3"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "EV1"}], " ", "EV2", " ", "v1"}], "+", 
         RowBox[{
          SuperscriptBox["EV1", "2"], " ", "v2"}], "+", 
         RowBox[{"EV3", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"EV3", " ", "v2"}], "-", 
            RowBox[{"EV2", " ", "v3"}]}], ")"}]}]}], ")"}], " ", 
       RowBox[{"Cos", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}], "+", 
      RowBox[{
       SqrtBox[
        RowBox[{
         SuperscriptBox["EV1", "2"], "+", 
         SuperscriptBox["EV2", "2"], "+", 
         SuperscriptBox["EV3", "2"]}]], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"EV3", " ", "v1"}], "-", 
         RowBox[{"EV1", " ", "v3"}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}]}], ")"}]}], ",", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      SuperscriptBox["EV1", "2"], "+", 
      SuperscriptBox["EV2", "2"], "+", 
      SuperscriptBox["EV3", "2"]}]], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"EV3", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"EV1", " ", "v1"}], "+", 
         RowBox[{"EV2", " ", "v2"}], "+", 
         RowBox[{"EV3", " ", "v3"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "EV1"}], " ", "EV3", " ", "v1"}], "+", 
         RowBox[{
          SuperscriptBox["EV1", "2"], " ", "v3"}], "+", 
         RowBox[{"EV2", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "EV3"}], " ", "v2"}], "+", 
            RowBox[{"EV2", " ", "v3"}]}], ")"}]}]}], ")"}], " ", 
       RowBox[{"Cos", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}], "+", 
      RowBox[{
       SqrtBox[
        RowBox[{
         SuperscriptBox["EV1", "2"], "+", 
         SuperscriptBox["EV2", "2"], "+", 
         SuperscriptBox["EV3", "2"]}]], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "EV2"}], " ", "v1"}], "+", 
         RowBox[{"EV1", " ", "v2"}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["EV1", "2"], "+", 
          SuperscriptBox["EV2", "2"], "+", 
          SuperscriptBox["EV3", "2"]}]], "]"}]}]}], ")"}]}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.694888852697896*^9, 3.69488890686425*^9, 
  3.694889092250931*^9, 3.694894710654211*^9, 3.694985287673437*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"genmat", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"Norm", "[", 
        RowBox[{"{", 
         RowBox[{"EV1", ",", "EV2", ",", "EV3"}], "}"}], "]"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"EV1", ",", "EV2", ",", "EV3"}], "}"}], "/", 
        RowBox[{"Norm", "[", 
         RowBox[{"{", 
          RowBox[{"EV1", ",", "EV2", ",", "EV3"}], "}"}], "]"}]}]}], "]"}], 
     ".", 
     RowBox[{"{", 
      RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}]}], ",", 
    RowBox[{"Assumptions", "\[Rule]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "v1", ",", "v2", ",", "v3", ",", "EV1", ",", "EV2", ",", "EV3"}], 
       "}"}], "\[Element]", "Reals"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.694888939069127*^9, 3.694888959746561*^9}, 
   3.6948890456404753`*^9, {3.694889094566194*^9, 3.694889096410424*^9}, {
   3.694889165013747*^9, 3.694889165260578*^9}}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.694888965789914*^9, 3.694889057062414*^9, 
  3.694889096929072*^9, 3.6948892180259657`*^9, 3.694894733832531*^9, 
  3.694985302144508*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{"genq", "\[Equal]", "genmat"}], "]"}]], "Input",
 CellChangeTimes->{{3.694889079111924*^9, 3.694889105343158*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.694889106732901*^9, 3.694889218095046*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compose successive rotations", "Section",
 CellChangeTimes->{{3.694892761109378*^9, 3.694892768794989*^9}}],

Cell["\<\
According to \
http://gamma.cs.unc.edu/courses/planning-f07/PAPERS/quaternions.pdf, we can \
generate a rotation with is a composition of multiple rotations by \
multiplying quaternions on the left\
\>", "Text",
 CellChangeTimes->{
  3.694892918442854*^9, {3.694892987953524*^9, 3.6948930401312513`*^9}, {
   3.6948932523296413`*^9, 3.694893252823852*^9}}],

Cell["We can define rotation by a quaternion", "Text",
 CellChangeTimes->{{3.6948947879668703`*^9, 3.694894796212668*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotateVectorByQuaternion", "[", 
   RowBox[{"v_", ",", "q_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "quatOut", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"quatOut", "=", 
      RowBox[{"q", "**", 
       RowBox[{"Quaternion", "[", 
        RowBox[{"0", ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"v", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "**", 
       RowBox[{"Conjugate", "[", "q", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"quatOut", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.694893388533745*^9, 3.694893401819862*^9}, 
   3.694894758065177*^9, {3.6949853703848753`*^9, 3.6949853751767263`*^9}}],

Cell["Then we can check that rotating by the composed quaternions", "Text",
 CellChangeTimes->{{3.6948948024337378`*^9, 3.694894830075193*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"q2", "=", 
  RowBox[{
   RowBox[{"convertToQuaternion", "[", 
    RowBox[{
     RowBox[{"Pi", "/", "2"}], ",", "0", ",", "0"}], "]"}], "**", 
   RowBox[{"convertToQuaternion", "[", 
    RowBox[{"0", ",", "0", ",", 
     RowBox[{"Pi", "/", "2"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6948933012692337`*^9, 3.694893327953212*^9}, {
  3.694893566251441*^9, 3.694893582235458*^9}, {3.6948939998135242`*^9, 
  3.694894004571456*^9}, {3.694894088599866*^9, 3.694894103324111*^9}, {
  3.694894442738143*^9, 3.6948944688717737`*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   FractionBox["1", "2"], ",", 
   FractionBox["1", "2"], ",", 
   RowBox[{"-", 
    FractionBox["1", "2"]}], ",", 
   FractionBox["1", "2"]}], "]"}]], "Output",
 CellChangeTimes->{
  3.694893333707357*^9, {3.694893570726964*^9, 3.694893583359007*^9}, {
   3.694893655841996*^9, 3.694893684857584*^9}, {3.6948940049118423`*^9, 
   3.6948940121452923`*^9}, 3.694894052303594*^9, {3.6948940943813457`*^9, 
   3.6948941037672987`*^9}, 3.694894738210144*^9, 3.694985305201395*^9, 
   3.694985380133107*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"rotateVectorByQuaternion", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", "q2"}], "]"}]], "Input",
 CellChangeTimes->{{3.694894057458808*^9, 3.694894072218411*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{3.6948940724946938`*^9, 3.6948947383764887`*^9, 
  3.6949853052495317`*^9, 3.694985380169724*^9}]
}, Open  ]],

Cell["is the same as doing the rotations successively", "Text",
 CellChangeTimes->{{3.694894841268749*^9, 3.694894852961134*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"vecout", "=", 
  RowBox[{"rotateVectorByQuaternion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
    RowBox[{"convertToQuaternion", "[", 
     RowBox[{"0", ",", "0", ",", 
      RowBox[{"Pi", "/", "2"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"rotateVectorByQuaternion", "[", 
  RowBox[{"vecout", ",", 
   RowBox[{"convertToQuaternion", "[", 
    RowBox[{
     RowBox[{"Pi", "/", "2"}], ",", "0", ",", "0"}], "]"}]}], "]"}]}], "Input",\

 CellChangeTimes->{{3.6948934270984364`*^9, 3.6948934405197783`*^9}, {
  3.694893701756188*^9, 3.694893717527833*^9}, {3.694893921829701*^9, 
  3.694893963723879*^9}, {3.694894032327608*^9, 3.694894033666*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "1", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6948934418077993`*^9, 3.694893660993272*^9, {3.694893707202186*^9, 
   3.69489371800563*^9}, 3.694893923057687*^9, 3.694893966103449*^9, 
   3.694894033917316*^9, 3.694894738321761*^9, 3.694985305282845*^9, 
   3.6949853802189837`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6948934418077993`*^9, 3.694893660993272*^9, {3.694893707202186*^9, 
   3.69489371800563*^9}, 3.694893923057687*^9, 3.694893966103449*^9, 
   3.694894033917316*^9, 3.694894738321761*^9, 3.694985305282845*^9, 
   3.6949853802285423`*^9}]
}, Open  ]],

Cell["\<\
This should also be the same as multiplied rotation matricies\
\>", "Text",
 CellChangeTimes->{{3.6948948730850573`*^9, 3.6948948872477217`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"vecout", "=", 
  RowBox[{
   RowBox[{"RotationMatrix", "[", 
    RowBox[{
     RowBox[{"Pi", "/", "2"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RotationMatrix", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "2"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ".", 
  "vecout"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RotationMatrix", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "2"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ".", 
  RowBox[{"RotationMatrix", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "2"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
  RowBox[{"{", 
   RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.694893504015876*^9, 3.694893517840229*^9}, {
  3.694894919683053*^9, 3.6948949893435993`*^9}, {3.6948950308334637`*^9, 
  3.694895038808043*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "1", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.69489351857437*^9, 3.69489473842623*^9, 3.694894940685896*^9, 
   3.694894991707879*^9, {3.694895033673606*^9, 3.694895039228478*^9}, 
   3.694985305333416*^9, 3.694985380285487*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{
  3.69489351857437*^9, 3.69489473842623*^9, 3.694894940685896*^9, 
   3.694894991707879*^9, {3.694895033673606*^9, 3.694895039228478*^9}, 
   3.694985305333416*^9, 3.694985380295006*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{
  3.69489351857437*^9, 3.69489473842623*^9, 3.694894940685896*^9, 
   3.694894991707879*^9, {3.694895033673606*^9, 3.694895039228478*^9}, 
   3.694985305333416*^9, 3.6949853803020983`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Note: the identity quaternion is {1,0,0,0}", "Subsection",
 CellChangeTimes->{{3.694902416612372*^9, 3.694902440766357*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"convertToQuaternion", "[", 
  RowBox[{"0", ",", 
   RowBox[{"Pi", "/", "2"}], ",", "0"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quaternion", "[", 
   RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "]"}], "**", 
  RowBox[{"convertToQuaternion", "[", 
   RowBox[{"0", ",", 
    RowBox[{"Pi", "/", "2"}], ",", "0"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"convertToQuaternion", "[", 
   RowBox[{"0", ",", 
    RowBox[{"Pi", "/", "2"}], ",", "0"}], "]"}], "**", 
  RowBox[{"Quaternion", "[", 
   RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.694902017631954*^9, 3.694902068978121*^9}, {
  3.694902350452694*^9, 3.694902407388754*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   FractionBox["1", 
    SqrtBox["2"]], ",", "0", ",", 
   FractionBox["1", 
    SqrtBox["2"]], ",", "0"}], "]"}]], "Output",
 CellChangeTimes->{{3.69490205772322*^9, 3.694902069721354*^9}, {
  3.69490235413111*^9, 3.694902407870551*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   FractionBox["1", 
    SqrtBox["2"]], ",", "0", ",", 
   FractionBox["1", 
    SqrtBox["2"]], ",", "0"}], "]"}]], "Output",
 CellChangeTimes->{{3.69490205772322*^9, 3.694902069721354*^9}, {
  3.69490235413111*^9, 3.694902407880066*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   FractionBox["1", 
    SqrtBox["2"]], ",", "0", ",", 
   FractionBox["1", 
    SqrtBox["2"]], ",", "0"}], "]"}]], "Output",
 CellChangeTimes->{{3.69490205772322*^9, 3.694902069721354*^9}, {
  3.69490235413111*^9, 3.6949024078871202`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Translate quaternion to axis and angle", "Section",
 CellChangeTimes->{{3.694900136569605*^9, 3.694900147841601*^9}}],

Cell["\<\
To convert back from the quaternion to axis and angle, we can look at this \
page http://www.euclideanspace.com/maths/geometry/rotations/conversions/\
quaternionToAngle/index.htm\
\>", "Text",
 CellChangeTimes->{{3.6949005840259132`*^9, 3.6949006199033937`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"convertToEV", "[", "q_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[Alpha]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Alpha]", "=", 
      RowBox[{"2", 
       RowBox[{"ArcCos", "[", 
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Alpha]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"q", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "*", 
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"q", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "*", 
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"q", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "*", 
            RowBox[{"q", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}]}], "}"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.694900339265077*^9, 3.694900489728348*^9}, {
  3.694900544606588*^9, 3.694900571245667*^9}}],

Cell["Test that it works", "Text",
 CellChangeTimes->{{3.694900671865625*^9, 3.6949006757352467`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"convertToEV", "[", 
   RowBox[{"convertToQuaternion", "[", 
    RowBox[{"3", ",", "2", ",", "5"}], "]"}], "]"}], "//", 
  "Simplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"convertToEV", "[", 
   RowBox[{"convertToQuaternion", "[", 
    RowBox[{"3", ",", "2.4", ",", "5"}], "]"}], "]"}], "//", 
  "Simplify"}]}], "Input",
 CellChangeTimes->{{3.6949006488974857`*^9, 3.694900663940922*^9}, {
  3.694900777841099*^9, 3.694900804311277*^9}, {3.69490085545462*^9, 
  3.6949008815873013`*^9}, {3.694900965862233*^9, 3.694900965950924*^9}, {
  3.694900999060658*^9, 3.69490102448451*^9}, {3.694901317491638*^9, 
  3.694901326118897*^9}, {3.694986368043077*^9, 3.694986376154283*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "2", ",", "5"}], "}"}]], "Output",
 CellChangeTimes->{{3.694900659182111*^9, 3.6949006642168922`*^9}, {
   3.694900778490185*^9, 3.694900804588784*^9}, {3.694900855776411*^9, 
   3.694900882001073*^9}, 3.694900966295444*^9, {3.6949009994799623`*^9, 
   3.6949010247146473`*^9}, 3.6949013264961567`*^9, {3.694986371176505*^9, 
   3.694986376469043*^9}, 3.69499147493538*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "2.9787160929954113`"}], ",", 
   RowBox[{"-", "2.3829728743963288`"}], ",", 
   RowBox[{"-", "4.964526821659018`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.694900659182111*^9, 3.6949006642168922`*^9}, {
   3.694900778490185*^9, 3.694900804588784*^9}, {3.694900855776411*^9, 
   3.694900882001073*^9}, 3.694900966295444*^9, {3.6949009994799623`*^9, 
   3.6949010247146473`*^9}, 3.6949013264961567`*^9, {3.694986371176505*^9, 
   3.694986376469043*^9}, 3.6949914749449577`*^9}]
}, Open  ]],

Cell["\<\
Works, but breaks down for rotations greater than 2\[Pi] (which is fine, \
since all the simulated rotations better be small.\
\>", "Text",
 CellChangeTimes->{{3.69490133125992*^9, 3.694901369037508*^9}, {
  3.6949864092074747`*^9, 3.694986410253009*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Norm", "[", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2", ",", "5"}], "}"}], "]"}], "//", 
  "N"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"2", "*", "Pi"}], "//", "N"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Norm", "[", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2.4", ",", "5"}], "}"}], "]"}], "//", "N"}]}], "Input",\

 CellChangeTimes->{{3.694986312546887*^9, 3.694986395358284*^9}}],

Cell[BoxData["6.164414002968976`"], "Output",
 CellChangeTimes->{{3.694986346363168*^9, 3.6949863958354483`*^9}, 
   3.694991474993308*^9}],

Cell[BoxData["6.283185307179586`"], "Output",
 CellChangeTimes->{{3.694986346363168*^9, 3.6949863958354483`*^9}, 
   3.694991475002962*^9}],

Cell[BoxData["6.305553108173778`"], "Output",
 CellChangeTimes->{{3.694986346363168*^9, 3.6949863958354483`*^9}, 
   3.694991475010086*^9}]
}, Open  ]],

Cell["in general", "Text",
 CellChangeTimes->{{3.694900679908699*^9, 3.694900686872767*^9}, {
  3.694901375505896*^9, 3.694901376057485*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{
   RowBox[{"convertToEV", "[", 
    RowBox[{"convertToQuaternion", "[", 
     RowBox[{"v1", ",", "v2", ",", "v3"}], "]"}], "]"}], ",", 
   RowBox[{"Assumptions", "\[Rule]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "\[Element]", 
     "Reals"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.694900698719759*^9, 3.694900748410356*^9}, {
  3.694986190012994*^9, 3.694986209081147*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox[
    RowBox[{"2", " ", "v1", " ", 
     RowBox[{"Abs", "[", 
      RowBox[{"Csc", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"ArcCos", "[", 
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"Sin", "[", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox["v1", "2"], "+", 
         SuperscriptBox["v2", "2"], "+", 
         SuperscriptBox["v3", "2"]}]]}], "]"}]}], 
    SqrtBox[
     RowBox[{
      SuperscriptBox["v1", "2"], "+", 
      SuperscriptBox["v2", "2"], "+", 
      SuperscriptBox["v3", "2"]}]]], ",", 
   FractionBox[
    RowBox[{"2", " ", "v2", " ", 
     RowBox[{"Abs", "[", 
      RowBox[{"Csc", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"ArcCos", "[", 
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"Sin", "[", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox["v1", "2"], "+", 
         SuperscriptBox["v2", "2"], "+", 
         SuperscriptBox["v3", "2"]}]]}], "]"}]}], 
    SqrtBox[
     RowBox[{
      SuperscriptBox["v1", "2"], "+", 
      SuperscriptBox["v2", "2"], "+", 
      SuperscriptBox["v3", "2"]}]]], ",", 
   FractionBox[
    RowBox[{"2", " ", "v3", " ", 
     RowBox[{"Abs", "[", 
      RowBox[{"Csc", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"ArcCos", "[", 
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["v1", "2"], "+", 
          SuperscriptBox["v2", "2"], "+", 
          SuperscriptBox["v3", "2"]}]]}], "]"}], "]"}], " ", 
     RowBox[{"Sin", "[", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox["v1", "2"], "+", 
         SuperscriptBox["v2", "2"], "+", 
         SuperscriptBox["v3", "2"]}]]}], "]"}]}], 
    SqrtBox[
     RowBox[{
      SuperscriptBox["v1", "2"], "+", 
      SuperscriptBox["v2", "2"], "+", 
      SuperscriptBox["v3", "2"]}]]]}], "}"}]], "Output",
 CellChangeTimes->{{3.694900705089081*^9, 3.694900748882654*^9}, {
   3.694986192642399*^9, 3.6949862105679398`*^9}, 3.69499147507935*^9}]
}, Open  ]],

Cell["With a little mental simplification this comes out right ", "Text",
 CellChangeTimes->{{3.694901250294319*^9, 3.69490130512643*^9}, 
   3.6949013469657383`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Construct C like statements", "Section",
 CellChangeTimes->{{3.694889537971499*^9, 3.694889539658167*^9}, {
  3.694901402281653*^9, 3.694901404351193*^9}, {3.694901458035872*^9, 
  3.694901458666086*^9}, {3.694903115180573*^9, 3.694903116484761*^9}}],

Cell[CellGroupData[{

Cell["\<\
Construct C like statement to calculate new quaternion from old one and new \
omega\
\>", "Subsection",
 CellChangeTimes->{{3.69490008804838*^9, 3.694900111650399*^9}, {
  3.694901460915893*^9, 3.694901461951105*^9}, {3.6949028951414347`*^9, 
  3.69490289660408*^9}}],

Cell["\<\
We update the quaternion by converting the Euler vector to a quaternion and \
multiplying on the left of the old one\
\>", "Text",
 CellChangeTimes->{{3.694988756007029*^9, 3.694988816745357*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"updatedquat", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"convertToQuaternion", "[", 
      RowBox[{
       RowBox[{"omega", "[", "0", "]"}], ",", 
       RowBox[{"omega", "[", "1", "]"}], ",", 
       RowBox[{"omega", "[", "2", "]"}]}], "]"}], "**", 
     RowBox[{"Quaternion", "[", 
      RowBox[{
       RowBox[{"quat", "[", "0", "]"}], ",", 
       RowBox[{"quat", "[", "1", "]"}], ",", 
       RowBox[{"quat", "[", "2", "]"}], ",", 
       RowBox[{"quat", "[", "3", "]"}]}], "]"}]}], ",", 
    RowBox[{"Assumptions", "\[Rule]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"omega", "[", "0", "]"}], ",", 
        RowBox[{"omega", "[", "1", "]"}], ",", 
        RowBox[{"omega", "[", "2", "]"}], ",", 
        RowBox[{"quat", "[", "0", "]"}], ",", 
        RowBox[{"quat", "[", "1", "]"}], ",", 
        RowBox[{"quat", "[", "2", "]"}], ",", 
        RowBox[{"quat", "[", "3", "]"}], ",", 
        RowBox[{"quat", "[", "4", "]"}]}], "}"}], "\[Element]", "Reals"}]}]}],
    "]"}]}]], "Input",
 CellChangeTimes->{{3.694986969107297*^9, 3.694987030239541*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "2", "]"}], "2"]}]], " ", 
       RowBox[{"quat", "[", "0", "]"}]}], "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}]}]}], ")"}], 
    "/", 
    RowBox[{"(", 
     SqrtBox[
      RowBox[{
       SuperscriptBox[
        RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "2", "]"}], "2"]}]], ")"}]}], ",", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "2", "]"}], "2"]}]], " ", 
       RowBox[{"quat", "[", "1", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}]}]}], ")"}], 
    "/", 
    RowBox[{"(", 
     SqrtBox[
      RowBox[{
       SuperscriptBox[
        RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "2", "]"}], "2"]}]], ")"}]}], ",", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "2", "]"}], "2"]}]], " ", 
       RowBox[{"quat", "[", "2", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}]}]}], ")"}], 
    "/", 
    RowBox[{"(", 
     SqrtBox[
      RowBox[{
       SuperscriptBox[
        RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "2", "]"}], "2"]}]], ")"}]}], ",", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}], " ", 
       SqrtBox[
        RowBox[{
         SuperscriptBox[
          RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
         SuperscriptBox[
          RowBox[{"omega", "[", "2", "]"}], "2"]}]], " ", 
       RowBox[{"quat", "[", "3", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         FractionBox["1", "2"], " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "]"}]}]}], ")"}], 
    "/", 
    RowBox[{"(", 
     SqrtBox[
      RowBox[{
       SuperscriptBox[
        RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
       SuperscriptBox[
        RowBox[{"omega", "[", "2", "]"}], "2"]}]], ")"}]}]}], "]"}]], "Output",\

 CellChangeTimes->{3.694986969454844*^9, 3.694987001481979*^9, 
  3.694987036725603*^9, 3.69499161882673*^9}]
}, Open  ]],

Cell["\<\
We see there are a lot of copies of the norm here, so we can replace that by \
one computation.\
\>", "Text",
 CellChangeTimes->{{3.694988822414812*^9, 3.6949888695864353`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"updatedquatsimp", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Collect", "[", 
     RowBox[{"#", ",", "alpha"}], "]"}], "&"}], "/@", 
   RowBox[{"(", 
    RowBox[{"updatedquat", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SqrtBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
          SuperscriptBox[
           RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
          SuperscriptBox[
           RowBox[{"omega", "[", "2", "]"}], "2"]}]], "\[Rule]", "alpha"}], 
       ",", 
       RowBox[{
        RowBox[{"1", "/", 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"omega", "[", "0", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "1", "]"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"omega", "[", "2", "]"}], "2"]}]]}], "\[Rule]", 
        RowBox[{"1", "/", "alpha"}]}]}], "}"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.694987039317998*^9, 3.694987055272241*^9}, {
  3.69498711336623*^9, 3.694987144651637*^9}, {3.6949878746289797`*^9, 
  3.694987936356731*^9}, {3.6949880106296253`*^9, 3.694988030237528*^9}, {
  3.694988106704385*^9, 3.694988190178543*^9}, {3.694988255800478*^9, 
  3.694988381348824*^9}, {3.694988488854609*^9, 3.694988492206707*^9}, {
  3.694991603689513*^9, 3.694991614421085*^9}}],

Cell[BoxData[
 RowBox[{"Quaternion", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      FractionBox["alpha", "2"], "]"}], " ", 
     RowBox[{"quat", "[", "0", "]"}]}], "+", 
    FractionBox[
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"omega", "[", "0", "]"}]}], " ", 
         RowBox[{"quat", "[", "1", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "2", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
      RowBox[{"Sin", "[", 
       FractionBox["alpha", "2"], "]"}]}], "alpha"]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      FractionBox["alpha", "2"], "]"}], " ", 
     RowBox[{"quat", "[", "1", "]"}]}], "+", 
    FractionBox[
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], " ", 
         RowBox[{"quat", "[", "0", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "2", "]"}]}], "+", 
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
      RowBox[{"Sin", "[", 
       FractionBox["alpha", "2"], "]"}]}], "alpha"]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      FractionBox["alpha", "2"], "]"}], " ", 
     RowBox[{"quat", "[", "2", "]"}]}], "+", 
    FractionBox[
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "0", "]"}]}], "+", 
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "1", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], " ", 
         RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
      RowBox[{"Sin", "[", 
       FractionBox["alpha", "2"], "]"}]}], "alpha"]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"Cos", "[", 
      FractionBox["alpha", "2"], "]"}], " ", 
     RowBox[{"quat", "[", "3", "]"}]}], "+", 
    FractionBox[
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "0", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "1", "]"}]}], "+", 
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], " ", 
         RowBox[{"quat", "[", "2", "]"}]}]}], ")"}], " ", 
      RowBox[{"Sin", "[", 
       FractionBox["alpha", "2"], "]"}]}], "alpha"]}]}], "]"}]], "Output",
 CellChangeTimes->{
  3.694987058030218*^9, {3.694987131936832*^9, 3.694987145183712*^9}, 
   3.694987876484277*^9, {3.694987909938991*^9, 3.694987936697051*^9}, {
   3.694988012838841*^9, 3.694988031171555*^9}, 3.694988115054584*^9, 
   3.6949881608729687`*^9, 3.69498819100776*^9, {3.6949882652850657`*^9, 
   3.694988344178719*^9}, 3.694988382200461*^9, 3.694988493617312*^9, 
   3.694991618911747*^9}]
}, Open  ]],

Cell["Construct the C-like statements", "Text",
 CellChangeTimes->{{3.6949888778786583`*^9, 3.694988889554789*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"newquat", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"quat1", "[", 
      RowBox[{"i", "-", "1"}], "]"}], "\[Equal]", 
     RowBox[{"updatedquatsimp", "[", 
      RowBox[{"[", "i", "]"}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6948951707872*^9, 3.6948951927871103`*^9}, {
  3.694895231971912*^9, 3.694895232094852*^9}, {3.694895303048555*^9, 
  3.694895306648621*^9}, {3.694895337396152*^9, 3.6948953490723763`*^9}, {
  3.6948953824294853`*^9, 3.694895496347122*^9}, {3.694895533314826*^9, 
  3.694895574837757*^9}, {3.694902994963928*^9, 3.694902998259297*^9}, {
  3.6949885075069923`*^9, 3.694988550515005*^9}, {3.6949887347219057`*^9, 
  3.6949887348008833`*^9}, {3.694992936911652*^9, 3.6949929509801807`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"quat1", "[", "0", "]"}], "\[Equal]", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       FractionBox["alpha", "2"], "]"}], " ", 
      RowBox[{"quat", "[", "0", "]"}]}], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"omega", "[", "0", "]"}]}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        FractionBox["alpha", "2"], "]"}]}], "alpha"]}]}], ",", 
   RowBox[{
    RowBox[{"quat1", "[", "1", "]"}], "\[Equal]", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       FractionBox["alpha", "2"], "]"}], " ", 
      RowBox[{"quat", "[", "1", "]"}]}], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        FractionBox["alpha", "2"], "]"}]}], "alpha"]}]}], ",", 
   RowBox[{
    RowBox[{"quat1", "[", "2", "]"}], "\[Equal]", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       FractionBox["alpha", "2"], "]"}], " ", 
      RowBox[{"quat", "[", "2", "]"}]}], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        FractionBox["alpha", "2"], "]"}]}], "alpha"]}]}], ",", 
   RowBox[{
    RowBox[{"quat1", "[", "3", "]"}], "\[Equal]", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", 
       FractionBox["alpha", "2"], "]"}], " ", 
      RowBox[{"quat", "[", "3", "]"}]}], "+", 
     FractionBox[
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "0", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", 
        FractionBox["alpha", "2"], "]"}]}], "alpha"]}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.694895575148542*^9, 3.694903001376274*^9, 
  3.694988514968136*^9, 3.694988551539833*^9, 3.694988735175221*^9, 
  3.694991618962798*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Small rotations", "Subsubsection",
 CellChangeTimes->{{3.694992713925415*^9, 3.69499271961754*^9}}],

Cell["\<\
My program was losing the small rotations. To try to be more accurate at \
small alphas, we can Taylor expand around 0\
\>", "Text",
 CellChangeTimes->{{3.6949927863299017`*^9, 3.69499281538833*^9}, {
  3.69499307896426*^9, 3.694993111577718*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"newquatSmall", "=", 
  RowBox[{
   RowBox[{"Normal", "[", 
    RowBox[{"Series", "[", 
     RowBox[{
      RowBox[{"List", "@@", "updatedquatsimp"}], ",", 
      RowBox[{"{", 
       RowBox[{"alpha", ",", "0", ",", "5"}], "}"}]}], "]"}], "]"}], "//", 
   "Simplify"}]}]], "Input",
 CellChangeTimes->{{3.69499220831842*^9, 3.694992316542439*^9}, {
  3.694992762323304*^9, 3.694992766074686*^9}, {3.694992958758762*^9, 
  3.694992986546109*^9}, {3.694993139973638*^9, 3.694993150935864*^9}, {
  3.694993203996933*^9, 3.694993265865287*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox["1", "3840"], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"10", " ", 
       RowBox[{"(", 
        RowBox[{"384", "-", 
         RowBox[{"48", " ", 
          SuperscriptBox["alpha", "2"]}], "+", 
         SuperscriptBox["alpha", "4"]}], ")"}], " ", 
       RowBox[{"quat", "[", "0", "]"}]}], "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1920", "-", 
         RowBox[{"80", " ", 
          SuperscriptBox["alpha", "2"]}], "+", 
         SuperscriptBox["alpha", "4"]}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "0", "]"}], " ", 
          RowBox[{"quat", "[", "1", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "+", 
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}]}], ")"}]}], ",", 
   RowBox[{
    FractionBox["1", "3840"], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1920", "-", 
         RowBox[{"80", " ", 
          SuperscriptBox["alpha", "2"]}], "+", 
         SuperscriptBox["alpha", "4"]}], ")"}], " ", 
       RowBox[{"omega", "[", "0", "]"}], " ", 
       RowBox[{"quat", "[", "0", "]"}]}], "+", 
      RowBox[{"10", " ", 
       RowBox[{"(", 
        RowBox[{"384", "-", 
         RowBox[{"48", " ", 
          SuperscriptBox["alpha", "2"]}], "+", 
         SuperscriptBox["alpha", "4"]}], ")"}], " ", 
       RowBox[{"quat", "[", "1", "]"}]}], "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1920", "-", 
         RowBox[{"80", " ", 
          SuperscriptBox["alpha", "2"]}], "+", 
         SuperscriptBox["alpha", "4"]}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"omega", "[", "2", "]"}], " ", 
          RowBox[{"quat", "[", "2", "]"}]}], "-", 
         RowBox[{
          RowBox[{"omega", "[", "1", "]"}], " ", 
          RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}]}], ")"}]}], ",", 
   RowBox[{
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"omega", "[", "1", "]"}], " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "+", 
       RowBox[{
        RowBox[{"omega", "[", "2", "]"}], " ", 
        RowBox[{"quat", "[", "1", "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"quat", "[", "2", "]"}]}], "-", 
       RowBox[{
        RowBox[{"omega", "[", "0", "]"}], " ", 
        RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "-", 
    RowBox[{
     FractionBox["1", "48"], " ", 
     SuperscriptBox["alpha", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"omega", "[", "1", "]"}], " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "+", 
       RowBox[{
        RowBox[{"omega", "[", "2", "]"}], " ", 
        RowBox[{"quat", "[", "1", "]"}]}], "+", 
       RowBox[{"6", " ", 
        RowBox[{"quat", "[", "2", "]"}]}], "-", 
       RowBox[{
        RowBox[{"omega", "[", "0", "]"}], " ", 
        RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "+", 
    FractionBox[
     RowBox[{
      SuperscriptBox["alpha", "4"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "0", "]"}]}], "+", 
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "1", "]"}]}], "+", 
        RowBox[{"10", " ", 
         RowBox[{"quat", "[", "2", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], " ", 
         RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "3840"]}], ",", 
   RowBox[{
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"omega", "[", "2", "]"}], " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "-", 
       RowBox[{
        RowBox[{"omega", "[", "1", "]"}], " ", 
        RowBox[{"quat", "[", "1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"omega", "[", "0", "]"}], " ", 
        RowBox[{"quat", "[", "2", "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "-", 
    RowBox[{
     FractionBox["1", "48"], " ", 
     SuperscriptBox["alpha", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"omega", "[", "2", "]"}], " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "-", 
       RowBox[{
        RowBox[{"omega", "[", "1", "]"}], " ", 
        RowBox[{"quat", "[", "1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"omega", "[", "0", "]"}], " ", 
        RowBox[{"quat", "[", "2", "]"}]}], "+", 
       RowBox[{"6", " ", 
        RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "+", 
    FractionBox[
     RowBox[{
      SuperscriptBox["alpha", "4"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"omega", "[", "2", "]"}], " ", 
         RowBox[{"quat", "[", "0", "]"}]}], "-", 
        RowBox[{
         RowBox[{"omega", "[", "1", "]"}], " ", 
         RowBox[{"quat", "[", "1", "]"}]}], "+", 
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], " ", 
         RowBox[{"quat", "[", "2", "]"}]}], "+", 
        RowBox[{"10", " ", 
         RowBox[{"quat", "[", "3", "]"}]}]}], ")"}]}], "3840"]}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.6949922380109367`*^9, 3.6949923169187098`*^9}, 
   3.694992801338635*^9, {3.694992962006672*^9, 3.694992986841136*^9}, 
   3.694993151366599*^9, 3.694993204365937*^9, {3.694993236360673*^9, 
   3.6949932661054287`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Construct C like statement to convert quaternion into EV", "Subsection",
 CellChangeTimes->{{3.694901415387059*^9, 3.694901472199749*^9}, {
  3.694902906267766*^9, 3.694902907719017*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"EVfromquat", "=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"omega", "[", "0", "]"}], ",", 
      RowBox[{"omega", "[", "1", "]"}], ",", 
      RowBox[{"omega", "[", "2", "]"}]}], "}"}], "==", 
    RowBox[{"convertToEV", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"quat", "[", "0", "]"}], ",", 
       RowBox[{"quat", "[", "1", "]"}], ",", 
       RowBox[{"quat", "[", "2", "]"}], ",", 
       RowBox[{"quat", "[", "3", "]"}]}], "}"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.694901393723143*^9, 3.694901397360141*^9}, {
  3.6949014786461887`*^9, 3.694901518785905*^9}, {3.69490156693606*^9, 
  3.6949015989982853`*^9}, {3.6949028360135527`*^9, 3.6949028406468353`*^9}, {
  3.6949030136498127`*^9, 3.694903020612762*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"omega", "[", "0", "]"}], "\[Equal]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"ArcCos", "[", 
       RowBox[{"quat", "[", "0", "]"}], "]"}], " ", 
      RowBox[{"quat", "[", "1", "]"}]}], 
     SqrtBox[
      RowBox[{"1", "-", 
       SuperscriptBox[
        RowBox[{"quat", "[", "0", "]"}], "2"]}]]]}], ",", 
   RowBox[{
    RowBox[{"omega", "[", "1", "]"}], "\[Equal]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"ArcCos", "[", 
       RowBox[{"quat", "[", "0", "]"}], "]"}], " ", 
      RowBox[{"quat", "[", "2", "]"}]}], 
     SqrtBox[
      RowBox[{"1", "-", 
       SuperscriptBox[
        RowBox[{"quat", "[", "0", "]"}], "2"]}]]]}], ",", 
   RowBox[{
    RowBox[{"omega", "[", "2", "]"}], "\[Equal]", 
    FractionBox[
     RowBox[{"2", " ", 
      RowBox[{"ArcCos", "[", 
       RowBox[{"quat", "[", "0", "]"}], "]"}], " ", 
      RowBox[{"quat", "[", "3", "]"}]}], 
     SqrtBox[
      RowBox[{"1", "-", 
       SuperscriptBox[
        RowBox[{"quat", "[", "0", "]"}], "2"]}]]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.6949015060561647`*^9, 3.694901519076091*^9}, 
   3.6949015992788467`*^9, 3.694902841617194*^9, 3.6949030215679092`*^9, 
   3.6949916190126543`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Small rotations", "Subsubsection",
 CellChangeTimes->{{3.6949937137207737`*^9, 3.694993715757392*^9}}],

Cell["\<\
When the rotation is small, the quaternion is close to the unit quaternion, \
(1,0,0,0). This means we can Taylor expand quat[0] around 1\
\>", "Text",
 CellChangeTimes->{{3.694993717748267*^9, 3.694993765144863*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{
   RowBox[{"Series", "[", 
    RowBox[{
     RowBox[{"convertToEV", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"quat", "[", "0", "]"}], ",", 
        RowBox[{"quat", "[", "1", "]"}], ",", 
        RowBox[{"quat", "[", "2", "]"}], ",", 
        RowBox[{"quat", "[", "3", "]"}]}], "}"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"quat", "[", "0", "]"}], ",", "1", ",", "4"}], "}"}]}], "]"}], 
   ",", 
   RowBox[{"Assumptions", "\[Rule]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"quat", "[", "0", "]"}], ",", 
       RowBox[{"quat", "[", "1", "]"}], ",", 
       RowBox[{"quat", "[", "2", "]"}], ",", 
       RowBox[{"quat", "[", "3", "]"}], ",", 
       RowBox[{"quat", "[", "4", "]"}]}], "}"}], "\[Element]", "Reals"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.694991887919232*^9, 3.694991969009069*^9}, {
   3.694993283961779*^9, 3.694993305765677*^9}, 3.694993412515339*^9, {
   3.6949935393476963`*^9, 3.694993554422227*^9}, {3.694993584505406*^9, 
   3.694993586090335*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], 
     RowBox[{"Ceiling", "[", 
      FractionBox[
       RowBox[{"Arg", "[", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{"quat", "[", "0", "]"}]}], "]"}], 
       RowBox[{"2", " ", "\[Pi]"}]], "]"}]], " ", 
    RowBox[{"(", 
     InterpretationBox[
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"quat", "[", "1", "]"}]}], "-", 
       RowBox[{
        FractionBox["2", "3"], " ", 
        RowBox[{"quat", "[", "1", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
       RowBox[{
        FractionBox["4", "15"], " ", 
        RowBox[{"quat", "[", "1", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
       RowBox[{
        FractionBox["4", "35"], " ", 
        RowBox[{"quat", "[", "1", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
       RowBox[{
        FractionBox["16", "315"], " ", 
        RowBox[{"quat", "[", "1", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
       InterpretationBox[
        SuperscriptBox[
         RowBox[{"O", "[", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
        SeriesData[
         $CellContext`quat[0], 1, {}, 0, 10, 2],
        Editable->False]}],
      SeriesData[
       $CellContext`quat[0], 1, {
       2 $CellContext`quat[1], 0, Rational[-2, 3] $CellContext`quat[1], 0, 
        Rational[4, 15] $CellContext`quat[1], 0, 
        Rational[-4, 35] $CellContext`quat[1], 0, 
        Rational[16, 315] $CellContext`quat[1]}, 0, 10, 2],
      Editable->False], ")"}]}], ",", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], 
     RowBox[{"Ceiling", "[", 
      FractionBox[
       RowBox[{"Arg", "[", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{"quat", "[", "0", "]"}]}], "]"}], 
       RowBox[{"2", " ", "\[Pi]"}]], "]"}]], " ", 
    RowBox[{"(", 
     InterpretationBox[
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"quat", "[", "2", "]"}]}], "-", 
       RowBox[{
        FractionBox["2", "3"], " ", 
        RowBox[{"quat", "[", "2", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
       RowBox[{
        FractionBox["4", "15"], " ", 
        RowBox[{"quat", "[", "2", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
       RowBox[{
        FractionBox["4", "35"], " ", 
        RowBox[{"quat", "[", "2", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
       RowBox[{
        FractionBox["16", "315"], " ", 
        RowBox[{"quat", "[", "2", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
       InterpretationBox[
        SuperscriptBox[
         RowBox[{"O", "[", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
        SeriesData[
         $CellContext`quat[0], 1, {}, 0, 10, 2],
        Editable->False]}],
      SeriesData[
       $CellContext`quat[0], 1, {
       2 $CellContext`quat[2], 0, Rational[-2, 3] $CellContext`quat[2], 0, 
        Rational[4, 15] $CellContext`quat[2], 0, 
        Rational[-4, 35] $CellContext`quat[2], 0, 
        Rational[16, 315] $CellContext`quat[2]}, 0, 10, 2],
      Editable->False], ")"}]}], ",", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], 
     RowBox[{"Ceiling", "[", 
      FractionBox[
       RowBox[{"Arg", "[", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{"quat", "[", "0", "]"}]}], "]"}], 
       RowBox[{"2", " ", "\[Pi]"}]], "]"}]], " ", 
    RowBox[{"(", 
     InterpretationBox[
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"quat", "[", "3", "]"}]}], "-", 
       RowBox[{
        FractionBox["2", "3"], " ", 
        RowBox[{"quat", "[", "3", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
       RowBox[{
        FractionBox["4", "15"], " ", 
        RowBox[{"quat", "[", "3", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
       RowBox[{
        FractionBox["4", "35"], " ", 
        RowBox[{"quat", "[", "3", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
       RowBox[{
        FractionBox["16", "315"], " ", 
        RowBox[{"quat", "[", "3", "]"}], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
       InterpretationBox[
        SuperscriptBox[
         RowBox[{"O", "[", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
        SeriesData[
         $CellContext`quat[0], 1, {}, 0, 10, 2],
        Editable->False]}],
      SeriesData[
       $CellContext`quat[0], 1, {
       2 $CellContext`quat[3], 0, Rational[-2, 3] $CellContext`quat[3], 0, 
        Rational[4, 15] $CellContext`quat[3], 0, 
        Rational[-4, 35] $CellContext`quat[3], 0, 
        Rational[16, 315] $CellContext`quat[3]}, 0, 10, 2],
      Editable->False], ")"}]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.694991919166911*^9, 3.694991969725671*^9, 3.6949921491811237`*^9, {
   3.694993293028775*^9, 3.6949933116749163`*^9}, {3.6949933580249434`*^9, 
   3.694993370206194*^9}, 3.694993413762581*^9, 3.694993555918724*^9, 
   3.6949935868614893`*^9}]
}, Open  ]],

Cell["\<\
Comes up with some strange -1^ something with Arg, but arg of anything \
positive (or 0) seems to just be 0, so we can get rid of those bits\
\>", "Text",
 CellChangeTimes->{{3.6949934619133253`*^9, 3.6949935144392357`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Arg", "[", 
  RowBox[{
   RowBox[{"-", "1"}], "+", "1"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Arg", "[", ".00001", "]"}]}], "Input",
 CellChangeTimes->{{3.6949934396499777`*^9, 3.69499345244077*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.694993453043054*^9}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.694993453050023*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "/.", 
  RowBox[{
   RowBox[{"Arg", "[", 
    RowBox[{
     RowBox[{"-", "1"}], "+", 
     RowBox[{"quat", "[", "0", "]"}]}], "]"}], "\[Rule]", "0"}]}]], "Input",
 CellChangeTimes->{{3.694992131305464*^9, 3.694992143191895*^9}, {
  3.694993340841614*^9, 3.694993367931654*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   InterpretationBox[
    RowBox[{
     RowBox[{"2", " ", 
      RowBox[{"quat", "[", "1", "]"}]}], "-", 
     RowBox[{
      FractionBox["2", "3"], " ", 
      RowBox[{"quat", "[", "1", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
     RowBox[{
      FractionBox["4", "15"], " ", 
      RowBox[{"quat", "[", "1", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
     RowBox[{
      FractionBox["4", "35"], " ", 
      RowBox[{"quat", "[", "1", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
     RowBox[{
      FractionBox["16", "315"], " ", 
      RowBox[{"quat", "[", "1", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
     InterpretationBox[
      SuperscriptBox[
       RowBox[{"O", "[", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
      SeriesData[
       $CellContext`quat[0], 1, {}, 0, 10, 2],
      Editable->False]}],
    SeriesData[
     $CellContext`quat[0], 1, {
     2 $CellContext`quat[1], 0, Rational[-2, 3] $CellContext`quat[1], 0, 
      Rational[4, 15] $CellContext`quat[1], 0, 
      Rational[-4, 35] $CellContext`quat[1], 0, 
      Rational[16, 315] $CellContext`quat[1]}, 0, 10, 2],
    Editable->False], ",", 
   InterpretationBox[
    RowBox[{
     RowBox[{"2", " ", 
      RowBox[{"quat", "[", "2", "]"}]}], "-", 
     RowBox[{
      FractionBox["2", "3"], " ", 
      RowBox[{"quat", "[", "2", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
     RowBox[{
      FractionBox["4", "15"], " ", 
      RowBox[{"quat", "[", "2", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
     RowBox[{
      FractionBox["4", "35"], " ", 
      RowBox[{"quat", "[", "2", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
     RowBox[{
      FractionBox["16", "315"], " ", 
      RowBox[{"quat", "[", "2", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
     InterpretationBox[
      SuperscriptBox[
       RowBox[{"O", "[", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
      SeriesData[
       $CellContext`quat[0], 1, {}, 0, 10, 2],
      Editable->False]}],
    SeriesData[
     $CellContext`quat[0], 1, {
     2 $CellContext`quat[2], 0, Rational[-2, 3] $CellContext`quat[2], 0, 
      Rational[4, 15] $CellContext`quat[2], 0, 
      Rational[-4, 35] $CellContext`quat[2], 0, 
      Rational[16, 315] $CellContext`quat[2]}, 0, 10, 2],
    Editable->False], ",", 
   InterpretationBox[
    RowBox[{
     RowBox[{"2", " ", 
      RowBox[{"quat", "[", "3", "]"}]}], "-", 
     RowBox[{
      FractionBox["2", "3"], " ", 
      RowBox[{"quat", "[", "3", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}]}], "+", 
     RowBox[{
      FractionBox["4", "15"], " ", 
      RowBox[{"quat", "[", "3", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "2"]}], "-", 
     RowBox[{
      FractionBox["4", "35"], " ", 
      RowBox[{"quat", "[", "3", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "3"]}], "+", 
     RowBox[{
      FractionBox["16", "315"], " ", 
      RowBox[{"quat", "[", "3", "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], ")"}], "4"]}], "+", 
     InterpretationBox[
      SuperscriptBox[
       RowBox[{"O", "[", 
        RowBox[{
         RowBox[{"quat", "[", "0", "]"}], "-", "1"}], "]"}], "5"],
      SeriesData[
       $CellContext`quat[0], 1, {}, 0, 10, 2],
      Editable->False]}],
    SeriesData[
     $CellContext`quat[0], 1, {
     2 $CellContext`quat[3], 0, Rational[-2, 3] $CellContext`quat[3], 0, 
      Rational[4, 15] $CellContext`quat[3], 0, 
      Rational[-4, 35] $CellContext`quat[3], 0, 
      Rational[16, 315] $CellContext`quat[3]}, 0, 10, 2],
    Editable->False]}], "}"}]], "Output",
 CellChangeTimes->{{3.694992143694803*^9, 3.694992152402237*^9}, {
  3.694993320477455*^9, 3.694993372072948*^9}}]
}, Open  ]],

Cell["Then we have", "Text",
 CellChangeTimes->{{3.694993779746819*^9, 3.6949937818061247`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"EVfromquatSmall", "=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"omega", "[", "0", "]"}], ",", 
      RowBox[{"omega", "[", "1", "]"}], ",", 
      RowBox[{"omega", "[", "2", "]"}]}], "}"}], "\[Equal]", 
    RowBox[{"Simplify", "[", 
     RowBox[{
      RowBox[{"Normal", "[", 
       RowBox[{"Series", "[", 
        RowBox[{
         RowBox[{"convertToEV", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"quat", "[", "0", "]"}], ",", 
            RowBox[{"quat", "[", "1", "]"}], ",", 
            RowBox[{"quat", "[", "2", "]"}], ",", 
            RowBox[{"quat", "[", "3", "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"quat", "[", "0", "]"}], ",", "1", ",", "4"}], "}"}]}], 
        "]"}], "]"}], "/.", 
      RowBox[{
       RowBox[{"Arg", "[", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{"quat", "[", "0", "]"}]}], "]"}], "\[Rule]", "0"}]}], 
     "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6949936069044657`*^9, 3.694993614546846*^9}, {
  3.694993658643826*^9, 3.694993684707862*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"omega", "[", "0", "]"}], "\[Equal]", 
    RowBox[{
     FractionBox["2", "315"], " ", 
     RowBox[{"(", 
      RowBox[{"488", "-", 
       RowBox[{"275", " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "+", 
       RowBox[{"144", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "2"]}], "-", 
       RowBox[{"50", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "3"]}], "+", 
       RowBox[{"8", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "4"]}]}], ")"}], " ", 
     RowBox[{"quat", "[", "1", "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"omega", "[", "1", "]"}], "\[Equal]", 
    RowBox[{
     FractionBox["2", "315"], " ", 
     RowBox[{"(", 
      RowBox[{"488", "-", 
       RowBox[{"275", " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "+", 
       RowBox[{"144", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "2"]}], "-", 
       RowBox[{"50", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "3"]}], "+", 
       RowBox[{"8", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "4"]}]}], ")"}], " ", 
     RowBox[{"quat", "[", "2", "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"omega", "[", "2", "]"}], "\[Equal]", 
    RowBox[{
     FractionBox["2", "315"], " ", 
     RowBox[{"(", 
      RowBox[{"488", "-", 
       RowBox[{"275", " ", 
        RowBox[{"quat", "[", "0", "]"}]}], "+", 
       RowBox[{"144", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "2"]}], "-", 
       RowBox[{"50", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "3"]}], "+", 
       RowBox[{"8", " ", 
        SuperscriptBox[
         RowBox[{"quat", "[", "0", "]"}], "4"]}]}], ")"}], " ", 
     RowBox[{"quat", "[", "3", "]"}]}]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.69499360764678*^9, 3.694993614791662*^9}, 
   3.694993686171637*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Write", "Section",
 CellChangeTimes->{{3.6949029421557503`*^9, 3.694902942863893*^9}}],

Cell[BoxData[{
 RowBox[{"DeleteFile", "[", 
  RowBox[{
   RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
   "\"\<quaternion_formulae.txt\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outfileLoc", "=", 
   RowBox[{"CreateFile", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
     "\"\<quaternion_formulae.txt\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outfile", "=", 
   RowBox[{"File", "[", "outfileLoc", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6887626715743513`*^9, 3.688762695097576*^9}, 
   3.68876276091197*^9, 3.688762825872221*^9, {3.6887657172492437`*^9, 
   3.6887657342583303`*^9}, {3.69490295464364*^9, 3.694902966648499*^9}}],

Cell[BoxData[{
 RowBox[{"WriteString", "[", 
  RowBox[{
  "outfile", ",", "\"\<Expressions for updating quaternion:\\n\\n\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteString", "[", 
   RowBox[{"outfile", ",", 
    RowBox[{"CForm", "[", 
     RowBox[{"alpha", "\[Equal]", 
      RowBox[{"Norm", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"omega", "[", "0", "]"}], ",", 
         RowBox[{"omega", "[", "1", "]"}], ",", 
         RowBox[{"omega", "[", "2", "]"}]}], "}"}], "]"}]}], "]"}], ",", 
    "\"\<;\>\"", ",", "\"\<\\n\\n\>\""}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", "\"\<Regular:\\n\\n\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquat", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquat", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquat", "[", 
     RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteString", "[", 
   RowBox[{"outfile", ",", 
    RowBox[{"CForm", "[", 
     RowBox[{"newquat", "[", 
      RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
    "\"\<\\n\\n\>\""}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", "\"\<Small angle:\\n\\n\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquatSmall", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquatSmall", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"newquatSmall", "[", 
     RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteString", "[", 
   RowBox[{"outfile", ",", 
    RowBox[{"CForm", "[", 
     RowBox[{"newquatSmall", "[", 
      RowBox[{"[", "4", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
    "\"\<\\n\\n\>\""}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{
  "outfile", ",", 
   "\"\<Regular expression for converting back to EV:\\n\\n\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"EVfromquat", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"EVfromquat", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteString", "[", 
   RowBox[{"outfile", ",", 
    RowBox[{"CForm", "[", 
     RowBox[{"EVfromquat", "[", 
      RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
    "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{
  "outfile", ",", 
   "\"\<Small angle expression for converting back to EV:\\n\\n\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"EVfromquatSmall", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"EVfromquatSmall", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"WriteString", "[", 
  RowBox[{"outfile", ",", 
   RowBox[{"CForm", "[", 
    RowBox[{"EVfromquatSmall", "[", 
     RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", "\"\<;\>\"", ",", 
   "\"\<\\n\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.68876262357826*^9, 3.6887626405123177`*^9}, {
  3.6887654159756393`*^9, 3.688765428675542*^9}, {3.688766664979315*^9, 
  3.688766777129668*^9}, {3.6887669135814447`*^9, 3.688766926305398*^9}, {
  3.688770480844369*^9, 3.68877052362743*^9}, {3.6887715770406523`*^9, 
  3.688771585927372*^9}, {3.688771618091227*^9, 3.688771618181243*^9}, {
  3.6888827034732857`*^9, 3.688882717637747*^9}, {3.694903037376333*^9, 
  3.694903091768676*^9}, {3.6949915089418697`*^9, 3.694991510619258*^9}, {
  3.6949918043548717`*^9, 3.694991860806857*^9}, {3.694993816828697*^9, 
  3.6949939420872593`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Close", "[", "outfile", "]"}]], "Input"],

Cell[BoxData["\<\"/Users/Matt/project_code/Motor_Freedom/tools/quaternion_\
formulae.txt\"\>"], "Output",
 CellChangeTimes->{{3.6887629134056187`*^9, 3.688762936915783*^9}, 
   3.6887639872949343`*^9, 3.6887667988245487`*^9, 3.6887669326629877`*^9, 
   3.6887680309129047`*^9, 3.688771626959546*^9, 3.6888306762734737`*^9, 
   3.688878054735424*^9, 3.688878169020768*^9, {3.688878476458947*^9, 
   3.688878490924356*^9}, 3.688879598998204*^9, 3.6888796551890697`*^9, 
   3.688879735311988*^9, 3.688879843912862*^9, 3.688879878080105*^9, 
   3.688882790384634*^9, 3.688882860338119*^9, 3.694903128695631*^9, 
   3.694991551105187*^9, 3.694991661465535*^9, {3.694991837179214*^9, 
   3.6949918644224663`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
Evaluator->"Kernel2",
WindowSize->{808, 911},
WindowMargins->{{214, Automatic}, {66, Automatic}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 94, 1, 92, "Title"],
Cell[677, 25, 435, 7, 49, "Text"],
Cell[1115, 34, 372, 7, 49, "Text"],
Cell[1490, 43, 170, 3, 32, "Input"],
Cell[1663, 48, 17533, 294, 173, "Text"],
Cell[CellGroupData[{
Cell[19221, 346, 335, 7, 32, "Input"],
Cell[19559, 355, 847, 25, 54, "Output"]
}, Open  ]],
Cell[20421, 383, 93, 1, 30, "Text"],
Cell[20517, 386, 115, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[20657, 391, 213, 4, 32, "Input"],
Cell[20873, 397, 234, 6, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21144, 408, 121, 1, 64, "Section"],
Cell[21268, 411, 458, 9, 87, "Text"],
Cell[21729, 422, 1198, 32, 75, "Input"],
Cell[CellGroupData[{
Cell[22952, 458, 320, 7, 32, "Input"],
Cell[23275, 467, 389, 10, 48, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[23713, 483, 100, 1, 64, "Section"],
Cell[23816, 486, 704, 13, 106, "Text"],
Cell[24523, 501, 135, 1, 30, "Text"],
Cell[24661, 504, 1462, 39, 96, "Input"],
Cell[26126, 545, 93, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[26244, 550, 303, 8, 32, "Input"],
Cell[26550, 560, 193, 5, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26780, 570, 326, 9, 32, "Input"],
Cell[27109, 581, 216, 5, 32, "Output"]
}, Open  ]],
Cell[27340, 589, 105, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[27470, 594, 639, 17, 54, "Input"],
Cell[28112, 613, 4851, 151, 259, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33000, 769, 999, 27, 75, "Input"],
Cell[34002, 798, 195, 3, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[34234, 806, 165, 3, 32, "Input"],
Cell[34402, 811, 95, 1, 32, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[34546, 818, 113, 1, 64, "Section"],
Cell[34662, 821, 366, 8, 49, "Text"],
Cell[35031, 831, 122, 1, 30, "Text"],
Cell[35156, 834, 1096, 28, 75, "Input"],
Cell[36255, 864, 143, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[36423, 869, 557, 12, 32, "Input"],
Cell[36983, 883, 556, 13, 44, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37576, 901, 226, 5, 32, "Input"],
Cell[37805, 908, 200, 4, 32, "Output"]
}, Open  ]],
Cell[38020, 915, 129, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[38174, 920, 732, 17, 54, "Input"],
Cell[38909, 939, 343, 7, 32, "Output"],
Cell[39255, 948, 343, 7, 32, "Output"]
}, Open  ]],
Cell[39613, 958, 155, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[39793, 965, 1094, 32, 75, "Input"],
Cell[40890, 999, 290, 6, 32, "Output"],
Cell[41183, 1007, 290, 6, 32, "Output"],
Cell[41476, 1015, 292, 6, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[41805, 1026, 130, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[41960, 1031, 723, 17, 75, "Input"],
Cell[42686, 1050, 292, 8, 48, "Output"],
Cell[42981, 1060, 292, 8, 48, "Output"],
Cell[43276, 1070, 294, 8, 48, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[43631, 1085, 123, 1, 64, "Section"],
Cell[43757, 1088, 272, 5, 49, "Text"],
Cell[44032, 1095, 1731, 50, 138, "Input"],
Cell[45766, 1147, 102, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[45893, 1152, 721, 15, 54, "Input"],
Cell[46617, 1169, 422, 7, 32, "Output"],
Cell[47042, 1178, 535, 10, 32, "Output"]
}, Open  ]],
Cell[47592, 1191, 265, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[47882, 1200, 431, 13, 75, "Input"],
Cell[48316, 1215, 139, 2, 32, "Output"],
Cell[48458, 1219, 139, 2, 32, "Output"],
Cell[48600, 1223, 139, 2, 32, "Output"]
}, Open  ]],
Cell[48754, 1228, 141, 2, 30, "Text"],
Cell[CellGroupData[{
Cell[48920, 1234, 475, 12, 32, "Input"],
Cell[49398, 1248, 3264, 103, 194, "Output"]
}, Open  ]],
Cell[52677, 1354, 166, 2, 30, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52880, 1361, 256, 3, 64, "Section"],
Cell[CellGroupData[{
Cell[53161, 1368, 277, 6, 44, "Subsection"],
Cell[53441, 1376, 206, 4, 49, "Text"],
Cell[CellGroupData[{
Cell[53672, 1384, 1136, 29, 117, "Input"],
Cell[54811, 1415, 7719, 233, 403, "Output"]
}, Open  ]],
Cell[62545, 1651, 187, 4, 30, "Text"],
Cell[CellGroupData[{
Cell[62757, 1659, 1395, 36, 127, "Input"],
Cell[64155, 1697, 3119, 90, 218, "Output"]
}, Open  ]],
Cell[67289, 1790, 115, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[67429, 1795, 848, 17, 32, "Input"],
Cell[68280, 1814, 3198, 94, 258, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[71515, 1913, 105, 1, 35, "Subsubsection"],
Cell[71623, 1916, 257, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[71905, 1925, 562, 13, 32, "Input"],
Cell[72470, 1940, 5605, 164, 335, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[78136, 2111, 193, 2, 44, "Subsection"],
Cell[CellGroupData[{
Cell[78354, 2117, 810, 19, 75, "Input"],
Cell[79167, 2138, 1273, 38, 102, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[80477, 2181, 108, 1, 35, "Subsubsection"],
Cell[80588, 2184, 227, 4, 49, "Text"],
Cell[CellGroupData[{
Cell[80840, 2192, 1094, 29, 54, "Input"],
Cell[81937, 2223, 6272, 181, 223, "Output"]
}, Open  ]],
Cell[88224, 2407, 234, 4, 49, "Text"],
Cell[CellGroupData[{
Cell[88483, 2415, 229, 5, 54, "Input"],
Cell[88715, 2422, 70, 1, 32, "Output"],
Cell[88788, 2425, 70, 1, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[88895, 2431, 305, 8, 32, "Input"],
Cell[89203, 2441, 4812, 142, 215, "Output"]
}, Open  ]],
Cell[94030, 2586, 96, 1, 30, "Text"],
Cell[CellGroupData[{
Cell[94151, 2591, 1159, 32, 117, "Input"],
Cell[95313, 2625, 1983, 58, 113, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[97369, 2691, 92, 1, 64, "Section"],
Cell[97464, 2694, 714, 17, 75, "Input"],
Cell[98181, 2713, 5214, 129, 516, "Input"],
Cell[CellGroupData[{
Cell[103420, 2846, 64, 1, 32, "Input"],
Cell[103487, 2849, 707, 10, 32, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

